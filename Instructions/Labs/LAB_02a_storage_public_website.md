---
lab:
  title: '演習 02a: パブリック Web サイト用のストレージを提供する'
  module: Guided Project - Azure Files and Azure Blobs
---


会社の Web サイトでは、製品イメージ、ビデオ、マーケティング資料、顧客の成功事例を提供しています。 世界各地に顧客を抱え、需要が急速に拡大しています。 コンテンツはミッション クリティカルであり、読み込み時間が低遅延である必要があります。 ドキュメントのバージョンを追跡し、ドキュメントが削除された場合はすばやく復元することが重要です。

## アーキテクチャ ダイアグラム

![1 つのストレージ アカウントと 1 つの BLOB コンテナーを示す図。](../Media/task-2.png)

## スキルアップ タスク
- 高可用性のストレージ アカウントを作成します。
- ストレージ アカウントに匿名のパブリック アクセスがあることを確認します。
- Web サイトのドキュメント用の BLOB ストレージ コンテナーを作成します。
- ファイルを簡単に復元できるように、論理的な削除を有効にします。
- BLOB のバージョン管理を有効にします。 


## 演習の手順

## 高可用性のストレージ アカウントを作成します。

1. パブリック Web サイトをサポートするストレージ アカウントを作成します。

    - ポータルで、`Storage accounts` を検索して選択します。  
    - **[+ 作成]** を選択します。 
    - **[リソース グループ]** で既存のリソースグループを選択します。 
    - **ストレージ アカウント名** に `publicwebsite` で始まる名前を設定します。 識別子を追加して、ストレージ アカウント名を必ず一意にしてください。
    - 他のすべての設定については、既定値をそのまま使用します。 
    - **[確認と作成]**、**[作成]** の順に選択します。
    - ストレージ アカウントがデプロイされるのを待って、**[リソースに移動]** を選択します。
         
1. このストレージには、リージョンの停止が発生した場合の高可用性が必要です。 さらに、セカンダリ リージョンへの読み取りアクセスを有効にします。[ストレージ アカウントの冗長性](https://learn.microsoft.com/azure/storage/common/storage-redundancy#geo-redundant-storage)に関する詳細を確認します。

    - ストレージ アカウントの **[データ管理]** セクションで、**[冗長性]** ブレードを選択します。 
    - **読み取りアクセス Geo 冗長ストレージ**が選択されていることを確認します。
    - プライマリとセカンダリの場所の情報を確認します。 

1. パブリック Web サイトの情報には、顧客がログインしなくてもアクセスできる必要があります。
    - ストレージ アカウントの **[設定]** セクションで、**[構成]** ブレードを選択します。
    - **[BLOB 匿名アクセスを許可する]** 設定が **[有効]** になっていることを確認します。
    - 変更を必ず**保存**してください。 
  
   
## 匿名読み取りアクセスを持つ BLOB ストレージ コンテナーを作成する

1. パブリック Web サイトには、さまざまなイメージやドキュメントがあります。 コンテンツの Blob Storage コンテナーを作成します。 [ストレージ コンテナー](https://learn.microsoft.com/azure/storage/blobs/storage-blobs-introduction#containers)に関する詳細を確認します。
    - ストレージ アカウントの **[データ ストレージ]** セクションで、**[コンテナー]** ブレードを選択します。 
    - **[+ コンテナー]** を選択します。 
    - コンテナーの**名前**が `public` であることを確認します。 
    - **［作成］** を選択します。 
    
1. 顧客は、認証なしにイメージを表示できる必要があります。 パブリック コンテナー BLOB の匿名読み取りアクセスを構成します。  [匿名パブリック アクセスの構成](https://learn.microsoft.com/azure/storage/blobs/anonymous-read-access-configure?tabs=portal)に関する詳細を確認します。
    - **public** コンテナーを選択します。 
    - **[概要]** ブレードで、**[アクセス レベルの変更]** を選択します。 
    - **[パブリック アクセス レベル]** が **[BLOB (BLOB 専用の匿名読み取りアクセス)]** に設定されていることを確認します。
    - **[OK]** を選択します。 

## ファイルのアップロードとアクセスのテストを演習します。

1. テストの場合、ファイルを **public** コンテナーにアップロードします。 ファイルの種類は関係ありません。 小さなイメージまたはテキスト ファイルを選択することをお勧めします。  
    - コンテナーを表示していることを確認します。 
    - **[アップロード]** を選択します。 
    - **ファイルを参照して**ファイルを選択します。 任意のファイルを参照します。 
    - **[アップロード]** を選択します。
    - アップロード ウィンドウを閉じ、ページを**最新の情報に更新し**、ファイルがアップロードされたことを確認します。 

1. アップロードしたファイルの URL を決定します。 ブラウザーを開き、URL をテストします。 
    - アップロードしたファイルを選択します。
    - **[概要]** タブで、**URL** をコピーします。
    - この URL を新しいブラウザー タブに貼り付けます。
    - 画像ファイルをアップロードした場合は、ブラウザーに表示されます。 その他の種類のファイルをダウンロードする必要があります。 

## 論理的な削除を構成する

1. Web サイトのドキュメントが削除されても復元できるようにすることが重要です。 BLOB の論理的な削除を 21 日間に構成します。 [BLOB の論理的な削除](https://learn.microsoft.com/azure/storage/blobs/soft-delete-container-enable?tabs=azure-portal)に関する詳細を確認します。
    - **ストレージ アカウント**の **[概要]** ブレードに移動します。
    - **[プロパティ]** タブで、**[BLOB サービス]** セクションを見つけます。
    - **BLOB の論理的な削除**設定を選択します。
    - **[BLOB の論理的な削除を有効にする]** が**チェックされていることを**確認します。
    - **[削除された BLOB を保持する期間 (日数)]** 設定を **21** に変更します。
    - **コンテナーの論理的な削除を有効にする**こともできます。 
    - 必ず変更を**保存**してください。 

1. 何かが削除された場合に、論理的な削除を使用してファイルを復元する演習をする必要があります。
    - ファイルをアップロードしたコンテナーに移動します。
    - アップロードしたファイルを選択し、**[削除]** を選択します。
    - **[OK]** を選択してファイルの削除を確認します。  
    - コンテナーの **[概要]** ページで、**[削除された BLOB を表示]** スライダーを切り替えます。 この切り替えは、検索ボックスの右側にあります。 
    - 削除したファイルを選択し、右端の省略記号を使用して、ファイルの**削除を取り消し**ます。 
    - コンテナーを更新し、ファイルが復元されたことを確認します。     

## BLOB のバージョン管理を構成する
1. さまざまなWeb サイト製品ドキュメントのバージョンを追跡することが重要です。 [BLOB のバージョン管理](https://learn.microsoft.com/azure/storage/blobs/versioning-enable?tabs=portal)に関する詳細を確認します。
    - **ストレージ アカウント**の **[概要]** ブレードに移動します。
    - **[プロパティ]** セクションで、**[BLOB サービス]** セクションを見つけます。
    - **[バージョン管理]** 設定を選択します。
    - **[BLOB のバージョン管理を有効にする]** チェックボックスがオンになっていることを確認します。
    - **すべてのバージョンを保持する**か、**後でバージョンを削除する**オプションに注目してください。 
    - 必ず変更を**保存**してください。 

1. 時間があれば、以前の BLOB バージョンの復元を試してください。
   - コンテナー ファイルの別のバージョンを**アップロード** します。 これにより、既存のファイルが上書きされます。 
   - 以前のバージョンのファイルは、**[削除された BLOB の表示]** ページに一覧表示されます。 
    

